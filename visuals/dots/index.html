<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - geometries</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #000;
				margin: 0px;
				overflow: hidden;
			}
		</style>
	</head>
	<body>

		<script src="../../three.js/build/three.min.js"></script>

		<script src="../../js/jquery.min.js"></script>

		<script>
		
			COLORSETS = {}
			COLORSETS.RAINBOWBRITE = new Array('#71c8bf', '#1ba554', '#cad93b', '#fef02f', '#fbb62c', '#f38a2e', '#ee592c', '#ea1d2b', '#b42767', '#65328f', '#52529f', '#20aeda')

			PI = 3.14159265359

			var container;

			var camera, scene, renderer;

			init();
			animate();

			function init() 
			{
				
				container = document.createElement( 'div' );
				document.body.appendChild( container );

				camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
				camera.position.z = 1500;

				scene = new THREE.Scene();
				//scene.fog = new THREE.FogExp2( 0xefd1b5, 0.0025 );
				//scene.fog = new THREE.FogExp2( 0x000000, 0.00045 );

				var light, object, object2, materials;

				scene.add( new THREE.AmbientLight( 0x404040 ) );

				light = new THREE.DirectionalLight( 0xffffff );
				light.position.set( 0, 1, 0 );
				scene.add( light );


				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setSize( window.innerWidth, window.innerHeight );

				container.appendChild( renderer.domElement );
				window.addEventListener( 'resize', onWindowResize, false );
				setupBindings()
				setupGrid()
			}
			
			function setupGrid()
			{
				gridRows = []
				var max = 11
				for (var x = 0; x < max; x++)
				{
					for (var y = 0; y < max; y++)
					{
						var obj = addObject()
						obj.position.x = (x - (max-1)/2) *100 
						obj.position.y = (y - (max-1)/2) *100
						obj.position.z = 0
					} 
									
				} 
				
			}

			function addObject()
			{
				var i = scene.children.length % COLORSETS.RAINBOWBRITE.length
				//var color = COLORSETS.RAINBOWBRITE[i]
				var color = new THREE.Color( 0xffffff );
				//color.setRGB( Math.floor(Math.random()*1.99),  Math.floor(Math.random()*1.99),  Math.floor(Math.random()*1.99) );

				materials = [
					new THREE.MeshBasicMaterial( { color: color, wireframe: false, transparent: false, opacity: 0.1, side: THREE.DoubleSide } )
				];

				// outer radius, inner radius, angle divisions, radial divisions
				object = THREE.SceneUtils.createMultiMaterialObject(
					new THREE.CircleGeometry( 30, 40, 0, Math.PI * 2 ), 
				materials );
				
				object.position.set( 0, 0, 0 );
				object.rotation.z = 3.14159/2
				object.speed = 8*(Math.random() +1) //{ x:0, y:0, z:8 }
				var s = (Math.random() - .5)/50
				object.rot = s
				object.scale.x = 1
				object.scale.y = 1
				scene.add( object );
				return object
			}
			
			function onWindowResize() 
			{
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
			}

			function animate() 
			{
				requestAnimationFrame( animate );
				render();
			}

			function render() 
			{
				var timer = Date.now() * 0.001;

				//camera.position.y = Math.cos( timer ) * 800;
				//camera.position.z = Math.sin( timer ) * 800;
				camera.rotation.z += 1
				
				camera.lookAt( { x:00, y:0, z:0 } );
				//var objectsToRemove = []
				
				for ( var i = 0; i < scene.children.length; i ++ ) 
				{
					var object = scene.children[ i ];
					var x = object.position.x
					var y = object.position.y
					//object.rotation.y += .01
					
					var b = x*y /100000
					var a = Math.sqrt((x*x) + (y*y))/5 + b
					object.scale.x = Math.sin(timer + a)*.4 + .4
					object.scale.y = Math.sin(timer + a)*.4 + .4
					
					object.position.z = Math.sin(timer + a) *100
					
					object.rotation.z = Math.sin(timer + a) + object.position.z/100 
				//	object.rotation.z = object.position.z/100
					//object.scale.x *= object.scale.x
					//object.scale.y *= object.scale.y
					/*
					if (object.scale.x > 10)
					{
						objectsToRemove.push( object );
					}
					*/
				}
				renderer.render( scene, camera );

				/*
				for ( var i = 0; i < objectsToRemove.length; i ++ ) 
				{
					var object = objectsToRemove[i]
					scene.remove(object);
				}
				*/
			}
			
			function setupBindings()
			{
				$(document).bind('keydown', function(e) { 
					/*
					Keyboard.shiftKey = e.shiftKey
					Keyboard.altKey   = e.altKey
					Keyboard.ctrlKey  = e.ctrlKey
					*/
					var retChar = 13
					var escChar = 27
					var sqChar = 192
					
					var char = String.fromCharCode(e.keyCode).toLowerCase()
					//if (char == "1") { addObject(e.keyCode) }
				//	addObject(e.keyCode)
				})
			}
			
		</script>

	</body>
</html>
